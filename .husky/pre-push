#!/bin/sh
# Always run from the repo root
REPO_ROOT=$(git rev-parse --show-toplevel)
cd "$REPO_ROOT" || exit 1

# Check for changes in the frontend directory (staged or unstaged)
changed_files=$(git diff --name-only --cached --diff-filter=ACMRTUXB)
unstaged_files=$(git diff --name-only --diff-filter=ACMRTUXB)

should_check_frontend=false
for file in $changed_files $unstaged_files; do
  case $file in
    frontend/*)
      should_check_frontend=true
      break
      ;;
  esac
done

if [ "$should_check_frontend" = true ]; then
  echo "\nüîé Running lint and build checks for frontend..."
  cd frontend || exit 1
  pnpm lint
  if [ $? -ne 0 ]; then
    echo "\n‚ùå Lint errors found in frontend. Please fix them before pushing."
    exit 1
  fi
  pnpm build
  if [ $? -ne 0 ]; then
    echo "\n‚ùå Build failed in frontend. Please fix build errors before pushing."
    exit 1
  fi
  cd "$REPO_ROOT" || exit 1
  echo "\n‚úÖ Pre-push checks passed. Proceeding with push."
  exit 0
fi

echo "\n‚úÖ No frontend changes detected. Proceeding with push."
